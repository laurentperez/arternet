<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>laurentperez.fr::talks::houdini</title>
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">
		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<style>
			.reveal section p {
			font-size: 0.8em !important;
			}
			.reveal section h2 {
			font-size: 1.2em !important;
			}
			.reveal section h3 {
			font-size: 1em !important;
			}
			.reveal section img {
			margin:0 !important;
			border: none !important;
			}
			.reveal section blockquote {
			font-size: 0.5em !important;
			}
			.reveal section ul li {
			font-size: 0.6em !important;
			}
			.reveal section ol li {
			font-size: 0.6em !important;
			}
			</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				
				<section>
					<h2>Meetup Frontend #1</h2>
					<p>MTH / Web Front</p>
					<p>" De la magie CSS avec Houdini "</p>
					<p>Dessin et animation nouvelle g√©n√©ration</p>
					<p><img src="awe.png" alt=""></p>
					<p><img src="mth.jpg" width="60px"/></p>
					<small>laurentperez.fr/talks/css1</small>
				</section>
				<!--
					Houdini est un nouveau jeu de fonctions qui donne
					un acc√®s direct au moteur CSS via JS, permettant de dessiner
					ou d'animer sans librairie tierce, et bien plus encore.
					Les travaux ont d√©but√© en 2016 et il arrive aujourd'hui 
					√† maturation
					Le talk pr√©sente toutes les nouvelles fonctions
					Avec d√©mos √† la cl√© !

				-->

				<section>
					<h2>Toi, public</h2>
					<p>Qui fait du front/UI/animation/print/TV ?</p>
					<p>Ratio natif iOS/Android (hors WebViews) &amp; web/print/vid√©o ?</p>
					<p>Exemples de derni√®res demandes cr√©as complexes ?</p>
				</section>

			<section>
				<h2>‚ú® CSS Houdini ‚ú®</h2>
				<p class="fragment fade-up">tl;dr : pour un acc√®s direct au moteur CSS via JS</p>
				<p class="fragment fade-up">on a un v√©ritable acc√®s au moteur</p>
				<p class="fragment fade-up">on peut y cr√©er nos propri√©t√©s, peinture/clip, animation, layout</p>
				<p class="fragment fade-up">travail commenc√© circa 2016</p>
				<p  class="fragment fade-up">suite logique du travail apr√®s WebComponents, WebWorkers et Web Animations API</p>
			</section>

			<section>
				<h2>Motivations</h2>
				<p  class="fragment fade-up">Ouvrir les portes de la "magie" CSS et pouvoir √©tendre le moteur sans attendre les fabricants ou ticket les librairies tierces</p>
				<small  class="fragment fade-up">Arr√™ter les hacks JS √† base de addClass/el.style/translate3D(0,0,0)</small>
				<p  class="fragment fade-up">S√©parer la logique dessin/animation (JS) et son style (CSS)</p>
				<p  class="fragment fade-up">Garantir du rendu √† 60fps hors thread UI principale</p>
				<p>Task force Google, Mozilla, Apple</p>
				<small  class="fragment fade-up">hacks JS = parce qu'on n'a pas le choix</small>
			</section>

			<section>
				<p>C'est une boite √† outils sur CSS</p>
				<p>Dans une maquette, 80% est "facile"</p>
				<p>C'est quand le moteur ne te donne pas les autres 20% que la recherche commence (google, stackoverflow, ...)</p>
				<p>Houdini = plus de "on peut pas le faire en CSS"</p>
			</section>

			<section>
				<p>Division en 6 nouvelles grandes APIs</p>
				<p><a href="https://github.com/w3c/css-houdini-drafts">https://github.com/w3c/css-houdini-drafts</a> (repo des specs)</p>
				<p><a href="https://drafts.css-houdini.org">https://drafts.css-houdini.org</a> (specs)</p>
				<ul>
					<li class="fragment fade-up">CSSOM API (CAPI)</li>
					<li class="fragment fade-up">Properties/Values API (PVAPI)</li>
					<li class="fragment fade-up">Paint API (PAPI)</li>
					<li class="fragment fade-up">Worklet Animation API (WAPI)</li>
					<li class="fragment fade-up">Layout API (LAPI)</li>
					<li class="fragment fade-up">Font Metrics API (FMAPI) *</li>
					</ul>
				<small class="fragment fade-up">* = pas encore d'impl√©mentation visible</small>
			</section>

			<section>
				<h2>Oui, mais le support ?</h2>
				<p><a href="https://www.chromestatus.com/features#houdini">https://www.chromestatus.com/features#houdini</a> </p>
				<p><a href="https://ishoudinireadyyet.com">https://ishoudinireadyyet.com</a> </p>
				<ul>
					<li>CSSOM : shipped Chrome, ii FF, in dev SF</li>
					<li>Properties Values API : partial 90% Chrome/SF, in dev FF</li>
					<li>Paint API : shipped Chrome, ii FF, in dev SF</li>
					<li>Worklet Animation API : partial 80% Chrome (sans chor√©graphie, Q1 2020), uc SF</li>
					<li>Layout API : partial 50% Chrome, ii FF</li>
					<li>Font Metrics API : rien, uniquement les specs</li>
				</ul>
				<small>ii : Intent to Implement, in dev : en cours : Safary Technology Preview, Chrome Canary</small>
			</section>

			<section>
				<p>Chromium (Blink) et Safari (WebKit) devant</p>
				<p>Firefox (Servo) est √† la bourre. IE va utiliser Blink (M78)</p>
				<p>lire les questions sur <a href="https://github.com/w3c/css-houdini-drafts/issues">https://github.com/w3c/css-houdini-drafts/issues</a></p>
				<p>r√©ponses des auteurs de specs et fabricants</p>
				<p class="fragment fade-up">Important : WAAPI √† 100% dans Safari TP / iOS13 (sans Worklet, uc), 80% CR FF</p>
			</section>

			<section>
				<p>Que Firefox soit en "retard" <em>n'est pas une mauvaise chose</em></p>
				<p class="fragment fade-up">C'est d√ª au switch de Gecko vers Servo √† partir de 2017</p>
				<p class="fragment fade-up">On veut de la diversit√© dans les moteurs de rendu, Servo est top</p>
				<p class="fragment fade-up">Pas de One Blink to rule them all</p>
				<small>FF Worklet mi Ao√ªt : <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1315239">https://bugzilla.mozilla.org/show_bug.cgi?id=1315239</a></small>
				<small>en Q3 2019 tout Houdini marqu√© en enhancement, les tickets dataient de 2017</small>
			</section>
			
			<section>
				<h2>CSSOM API</h2>
				<p>Fini la concat√©nation et les typos, et enfin le try/catch</p>
				<p>Nouveaux objets CSS* et .attributesStyleMap/.computedStyleMap</p>
				<pre class="fragment fade-up"><code class="css">
el.attributeStyleMap.set('opacity', CSS.number(0.3));
el.attributeStyleMap.has('opacity');
el.computedStyleMap().get('opacity').value // ex getComputedStyle
el.attributeStyleMap.delete('opacity')
el.attributeStyleMap.clear();
CSS.vw('100'); CSS.px(42);
CSS.percent('10'); CSS.ms(300);
new CSSMathSum(CSS.vw(100), CSS.px(-10)) // calc(100vw + -10px)
new CSSStyleValue.parse('transform', 'translte3d(...)'); // throw
				</code></pre>
			</section>

			<section>
				<h2>üîë Properties/Values API üîë</h2>
				<p >De la structure/typage dans des variables CSS custom</p>
				<small>... on rappelle BEM/SASS/Less pour une structure de classes maintenable</small>
				<p class="fragment fade-up">Types support√©s : length, number, %, color, image, url(), integer, angle, time, dpi, transform</p>
				<pre class="fragment fade-up"><code class="css">
CSS.registerProperty({
		name: '--sky',
		syntax: '&lt;color&gt;',
		inherits: true,
		initialValue: 'vanilla',
});</code></pre>
				<small>SVP ne pas r√©inventer des horreurs lexicales comme couleur=color, ni substituer aux meta data-* HTML5</small>
				<p><a href="../cssp">demo</a></p>
			</section>

			<section><h2>üé® Paint API üé®</h2>
				<p>Dessin 2D personnalis√© avec <em>background:paint('foo');</em></p>
				<p>Introduction de <em>PaintWorklet</em> : analogie avec les <em>ServiceWorkers</em> pour le cache/offline/push notifs</p>
				<p class="fragment fade-up">Une <em>Worklet</em> est un JS short-lived, d√©pla√ßable entre threads au gr√© du moteur</p>
				<p class="fragment fade-up">But : qu'elle ne tourne pas dans la main thread (main JS sur thread UI sans rAf = lag) mais dans une autre thread</p>
				<p class="fragment fade-up">La Paint API donne un <em>Canvas</em> sans acc√®s au DOM</p>
				<small class="fragment fade-up">donc oui le 31/10 tu peux faire background:paint(üéÉ);</small>
				<p><a href="../cssp">demo (voir les 2 threads + FPS)</a></p>
			</section>

			<section>
				<h2>Short lived ?</h2>
				<p>La Worklet se r√©veille (repaint) quand :</p>
				<p class="fragment fade-up">Une des propri√©t√©s CSS mapp√©es change</p>
				<p class="fragment fade-up">La g√©om√©trie de l'√©l√©ment peint change (ex:resize)</p>
				<p class="fragment fade-up">La timeline bouge (ex:scroll, demo plus loin)</p>
				<p class="fragment fade-up">Une Worklet va peindre √† <em>chaque frame, donc au minimum √† 60fps</em></p>
				<p class="fragment fade-up">C'est un WebWorker en plus l√©ger, c√¢bl√© directement sur le Compositing : tu repaint seulement une zone, sans repasser par les calculs DOM. Voir √ßa un peu comme un layer Photoshop </p>
			</section>

			<section>
				<h2>S√©curit√©</h2>
				<ul>
					<li>Aucun acc√®s au DOM et les Properties sont readonly. Le Canvas est √©tanche. Si besoin de DOM, faire un Canvas classique sans Paint API</li>
					<li class="fragment fade-up">Car tu n'as pas sp√©cialement envie qu'un Canvas charg√© <em>depuis JS/CSS externe</em> puisse lire ou repeindre des √©l√©ments du DOM</li>
					<li class="fragment fade-up">exemple : redessiner champ input de saisie de CB</li>
					<li class="fragment fade-up">Les Properties readonly aussi contre boucle repaint infinie</li>
					<li>c'est un <em>PaintRenderingContext2D</em> subset de <em>CanvasRenderingContext2D</em></li>
				</ul>
				<img src="gifhack.gif" width="200px" style="border: none;" alt="">
			</section>

			<section>
				<p>Values trop simples ? Comment passer des complexes ?</p>
				<p class="fragment fade-up">exemple : un stream audio/vid√©o/trading/ECU (data automobile) </p>
				<p class="fragment fade-up">solution (Juin 2019) : ajouter un type &lt;blob&gt;</p>
				<p><a href="https://github.com/w3c/css-houdini-drafts/issues/872">https://github.com/w3c/css-houdini-drafts/issues/872</a></p>
				<p class="fragment fade-up">... puis <em>postMessage</em> plus tard pour pas devoir repasser la Value CSS dans la main UI thread</p>
				<p>valable aussi pour AnimationWorklet</p>
			</section>

			<section>
				<p>Skins : background:paint('488GT3'); background:paint('motec');</p>
				<pre class="fragment fade-up"><code class="css">
--gear: 3;
--speed: 81;
--pos: 16;
--laptime: 7.28;
--rpm: 6000; /* jauge rectangle en Ferrari, arc rectangles en Motec */
				</code></pre>
				<img src="488.jpeg" width="350px" alt="">
				<img src="motec.jpeg" width="350px" alt="">
			</section>

			<section>
				<h2>üé¨ Worklet Animation API üé¨</h2>
				<p>Animations non blocking √† 60fps relatives √† la timeline et au scroll
				... c'est surtout fait pour le scroll, et √ßa le fait bien</p>
				<small>qui a d√©j√† fait des parallaxes fluides ? des offsets / staggering ? anime.JS ?</small>
				<p>Syntaxe : <em>AnimationWorklet + KeyFrameEffect</em></p>
				<p>Note : s√©quence/chor√©graphie/playback √† faire √† la main. Un peu p√©nible, car <em>GroupEffect</em> dans la spec</p>
			</section>
			<section>
				<p>Encore une API d'animation ?</p>
				<small>... on a d√©j√† CSS transitions, CSS animations (@keyframes), Web Animations API (el.animate({...}).pause())</small>
				<p class="fragment fade-up">NON. La Worklet est une <em>extension</em> de WAAPI qui donne un <em>Effect</em>, des <em>timelines</em> libres (dont une <em>ScrollTimeline</em>) et un √©tat optionel (stateful)</p>
				<p class="fragment fade-up">ex: se souvenir de l'√©tat quand le moteur bouge la Worklet entre threads</p>
				<p class="fragment fade-up">ex: acc√©l√©rer/distordre le temps (document.timeline modifiable)</p>
				<p><a href="../waapi">demo (activer le paint flashing)</a></p>				
			</section>

			<section>
				<p>Sprints et roadmap : <a href="https://www.chromium.org/teams/animations/animation-objectives">https://www.chromium.org/teams/animations/animation-objectives</a></p>
				<p>Pour le moment (Ao√ªt), <em>GroupEffect</em> = groupe de <em>KeyFrameEffects</em> est cach√© (flag)</p>
				<p class="fragment fade-up">exemple : d√©marrer l'animation B quand la A est √† 50%, d√©marrer B, C, D en m√™me temps mais avec des offsets (= parallaxe/stagger), pause() ou play() les effets en bloc</p>
				<small class="fragment fade-up">Travail important de Yi Gu sur la Chor√©graphie, Parallel, S√©quence et Staggering pour am√©liorer la spec</small>
			</section>
			<section>
				<img src="pigeon.gif" alt="">
				<p>lire les travaux de Yi sur <a href="https://github.com/yi-gu/group_effect">https://github.com/yi-gu/group_effect</a></p>
				<p>nouveaux types SequenceEffect, ParallelEffect, StaggerEffect en plus de GroupEffect</p>
				<p>Q1 2020</p>
				<small>Question √† Julian Garnier (anime.js) <a href>https://github.com/juliangarnier/anime/issues/602</a></small>
			</section>

			<section><h2>üñºÔ∏è Layout API üñºÔ∏è</h2>
				<p>Quand flex ou grid ne suffisent plus (oui oui)</p>
				<p>tl;dr : √©crire son propre display:layout('monlayout');</p>
				<p><a href="https://houdini.glitch.me/layout">https://houdini.glitch.me/layout</a></p>
				<small>Rappel : c'est Bloomberg qui a sponsoris√© grid dans WebKit (Igalia)</small>
				<p>Conteneur de <em>LayoutChild/Fragments</em> dans un <em>ParentLayout</em></p>
				<small>Le <em>Parent</em> a des borders, paddings : les <em>Edges</em>. Entre les <em>Edges</em>, on a des <em>Constraints</em>. Les <em>LayoutChild</em> sont dans ces <em>Constraints</em> et ont des <em>Fragments</em></small>
				<p>La clef : chaque <em>Fragment</em> a un <em>inlineOffset/blockOffset</em> pour le positionner par rapport √† la box de son <em>Child</em></p>
				<p>C'est - en gros - du position:relative; dynamique dans un <em>wireframe</em></p>
			</section>

			<section>
				<p>penser √† Tetris : une disposition de blocs dans un espace constraint</p>
				<p class="fragment fade-up">display:layout('L'); display:layout('4bar'); ‚ñõ ‚ñö ‚ñê</p>
				<small class="fragment fade-up">4bar est ici 4 Fragments empil√©s, L 3 et le 4e a un offset</small>
				<p class="fragment fade-up">Les blocs Fragments sont _parall√©lisables_ pour les moteurs next-gen (LayoutNG CR, WebRender FF) : quand le 4bar rentre et 'flashe' un Tetris, 4 lignes sont √† effacer, et y-4 pour au dessus</p>
				<p class="fragment fade-up">Cas d'usage : architecture, UI norm√©s (affichage dash militaire/voiture/avion, presse √©crite, eBooks, ePub Comics)</p>
				<small class="fragment fade-up">des utilisaturs.trices de QuarkXPress/InDesign ?</small>
				<p><a href="https://css-houdini.rocks/masonry/">demo</a></p>
			</section>

			<section>
				<h2>üî† Font Metrics API üî†</h2>
				<p>... spec utilitaire caus√©e par la Layout API :</p>
				<p>dessiner des blocs custom c'est cool mais : on a parfois besoin de g√©rer du texte dedans</p>
				<small class="fragment fade-up">ex : faire son propre line-breaking, conna√Ætre la baseline dans un Fragment, les tailles r√©elles des symboles math chimie, des ligatures ≈í, √Ü, ŸÖÿ≠ÿ±ŸÉ, et c√¶tera ‚Ä¶ &lt;- c'est des points de suspension, pas '...' </small>
				<p class="fragment fade-up">exposer seulement la Font ne suffit pas : il faut descendre au niveau du <em>glyphe</em> dessin√© par chaque navigateur</p>
			</section>
				
			<section>
				<h2>D√©mo avanc√©es</h2>
				<p>avec Chrome Canary, Safari Technology Preview ou Firefox Nightly (peu d'impl√©ment√©)</p>
				<p><a href="https://css-houdini.rocks">https://css-houdini.rocks</a></p>
				<p>notamment : Inner Borders, Masonry, Random Bubble Masks</p>
			</section>

			<section>
				<h2>Pour suivre / plus loin</h2>
				<p><a href="https://github.com/w3c/css-houdini-drafts/wiki/Meeting-Planning-Pages">https://github.com/w3c/css-houdini-drafts/wiki/Meeting-Planning-Pages</a> (meetings trimestriels CSSWG)</p>
				<p><a href="https://www.chromium.org/teams">https://www.chromium.org/teams</a> (r√©tros agiles)</p>
				<p><a href="https://houdini.glitch.me">https://houdini.glitch.me</a> (d√©mos)</p>
				<p>Q2 2020, rapprochement de Paint API et Web Animations API :</p>
				<p>On peut imaginer un IDE en ligne 100% web, gratuit et open source qui remplacerait Sketch/Adobe XD, 100% extensible car bas√© sur des APIs ouvertes</p>
				<p>Plus de "on peut pas le faire en CSS" : mais √ßa va demander des comp√©tences de dessin canvas2D et animation... FullFullStack ?</p>
			</section>

				<!--
				<section>Recap blogs wk/chome</section>
				<section>pwa</section>
				<section>preload srcset</section>
				-->


				<style>
						.darkside_txt {
							color: white;
						}
						.darkside {
							background-image:url('anakin.png');
							background-size: contain;
							height:250px;
						}
						@media (prefers-color-scheme: dark) {
							body {
								background-color: black;
								color: white;
							}
							.darkside {
								background-image:url('vador.jpg');
							}
							.darkside_txt {
								color: red;
							}
						}
						</style>
						<section>
							<h2>Dark mode</h2>
							<p class="darkside_txt">iOS13, Android Q</p>
							<pre><code class="css" data-trim data-line-numbers="1">
	@media (prefers-color-scheme: dark) {
		body {
			background-color: black;
			color: white;
		}
		.darkside {
			background-image:url('vador.jpg')
		}
		}
								</code></pre>
								<p class="darkside"></p>
						</section>

				<section>EOF</section>

			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
